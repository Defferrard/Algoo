19c6bb6bc61fcb92e0a8f30d5446a55e
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.routingControllersOptions = void 0;
const AuthCtrl_1 = require("./controllers/AuthCtrl");
const GameRoomCtrl_1 = require("./controllers/GameRoomCtrl");
const passport_1 = __importDefault(require("passport"));
const logger_1 = require("~/utils/logger");
exports.routingControllersOptions = {
    routePrefix: '/api/v1',
    middlewares: [logger_1.middleware],
    // NOTE :
    // Controllers directory discovery is not working with routing-controllers-openapi
    // TODO: Waiting for https://github.com/epiphone/routing-controllers-openapi/issues/81 to be resolved
    controllers: [AuthCtrl_1.AuthCtrl, GameRoomCtrl_1.GameRoomCtrl],
    validation: {
        whitelist: true,
    },
    authorizationChecker: async (action, _roles) => new Promise((resolve, reject) => {
        passport_1.default.authenticate('jwt', (err, user) => {
            if (err)
                return reject(err);
            if (!user)
                return resolve(false);
            action.request.user = user;
            return resolve(true);
        })(action.request, action.response, action.next);
    }),
    currentUserChecker: (action) => action.request.user,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEdpdGh1YlxcQWxnb29cXGJhY2tlbmRcXHNyY1xccm91dGluZ0NvbnRyb2xsZXJzT3B0aW9ucy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxxREFBa0Q7QUFDbEQsNkRBQTBEO0FBRTFELHdEQUFnQztBQUVoQywyQ0FBZ0U7QUFFbkQsUUFBQSx5QkFBeUIsR0FBOEI7SUFDbEUsV0FBVyxFQUFFLFNBQVM7SUFDdEIsV0FBVyxFQUFFLENBQUMsbUJBQWdCLENBQUM7SUFDL0IsU0FBUztJQUNULGtGQUFrRjtJQUNsRixxR0FBcUc7SUFDckcsV0FBVyxFQUFFLENBQUMsbUJBQVEsRUFBRSwyQkFBWSxDQUFDO0lBQ3JDLFVBQVUsRUFBRTtRQUNWLFNBQVMsRUFBRSxJQUFJO0tBQ2hCO0lBQ0Qsb0JBQW9CLEVBQUUsS0FBSyxFQUFFLE1BQWMsRUFBRSxNQUFhLEVBQUUsRUFBRSxDQUM1RCxJQUFJLE9BQU8sQ0FBVSxDQUFDLE9BQWlCLEVBQUUsTUFBZ0IsRUFBRSxFQUFFO1FBQzNELGtCQUFRLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxDQUFDLEdBQVcsRUFBRSxJQUFXLEVBQUUsRUFBRTtZQUN4RCxJQUFJLEdBQUc7Z0JBQUUsT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDNUIsSUFBSSxDQUFDLElBQUk7Z0JBQUUsT0FBTyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDakMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQzNCLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkQsQ0FBQyxDQUFDO0lBQ0osa0JBQWtCLEVBQUUsQ0FBQyxNQUFjLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSTtDQUM1RCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxHaXRodWJcXEFsZ29vXFxiYWNrZW5kXFxzcmNcXHJvdXRpbmdDb250cm9sbGVyc09wdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXV0aEN0cmwgfSBmcm9tICcuL2NvbnRyb2xsZXJzL0F1dGhDdHJsJztcbmltcG9ydCB7IEdhbWVSb29tQ3RybCB9IGZyb20gJy4vY29udHJvbGxlcnMvR2FtZVJvb21DdHJsJztcbmltcG9ydCB7IFVzZXIgfSBmcm9tICdAZGVmZmVycmFyZC9hbGdvby1jb3JlL3NyYy9zb2NrZXQnO1xuaW1wb3J0IHBhc3Nwb3J0IGZyb20gJ3Bhc3Nwb3J0JztcbmltcG9ydCB7IEFjdGlvbiwgUm91dGluZ0NvbnRyb2xsZXJzT3B0aW9ucyB9IGZyb20gJ3JvdXRpbmctY29udHJvbGxlcnMnO1xuaW1wb3J0IHsgbWlkZGxld2FyZSBhcyBsb2dnZXJNaWRkbGV3YXJlIH0gZnJvbSAnfi91dGlscy9sb2dnZXInO1xuXG5leHBvcnQgY29uc3Qgcm91dGluZ0NvbnRyb2xsZXJzT3B0aW9uczogUm91dGluZ0NvbnRyb2xsZXJzT3B0aW9ucyA9IHtcbiAgcm91dGVQcmVmaXg6ICcvYXBpL3YxJyxcbiAgbWlkZGxld2FyZXM6IFtsb2dnZXJNaWRkbGV3YXJlXSxcbiAgLy8gTk9URSA6XG4gIC8vIENvbnRyb2xsZXJzIGRpcmVjdG9yeSBkaXNjb3ZlcnkgaXMgbm90IHdvcmtpbmcgd2l0aCByb3V0aW5nLWNvbnRyb2xsZXJzLW9wZW5hcGlcbiAgLy8gVE9ETzogV2FpdGluZyBmb3IgaHR0cHM6Ly9naXRodWIuY29tL2VwaXBob25lL3JvdXRpbmctY29udHJvbGxlcnMtb3BlbmFwaS9pc3N1ZXMvODEgdG8gYmUgcmVzb2x2ZWRcbiAgY29udHJvbGxlcnM6IFtBdXRoQ3RybCwgR2FtZVJvb21DdHJsXSxcbiAgdmFsaWRhdGlvbjoge1xuICAgIHdoaXRlbGlzdDogdHJ1ZSxcbiAgfSxcbiAgYXV0aG9yaXphdGlvbkNoZWNrZXI6IGFzeW5jIChhY3Rpb246IEFjdGlvbiwgX3JvbGVzOiBhbnlbXSkgPT5cbiAgICBuZXcgUHJvbWlzZTxib29sZWFuPigocmVzb2x2ZTogRnVuY3Rpb24sIHJlamVjdDogRnVuY3Rpb24pID0+IHtcbiAgICAgIHBhc3Nwb3J0LmF1dGhlbnRpY2F0ZSgnand0JywgKGVycj86IEVycm9yLCB1c2VyPzogVXNlcikgPT4ge1xuICAgICAgICBpZiAoZXJyKSByZXR1cm4gcmVqZWN0KGVycik7XG4gICAgICAgIGlmICghdXNlcikgcmV0dXJuIHJlc29sdmUoZmFsc2UpO1xuICAgICAgICBhY3Rpb24ucmVxdWVzdC51c2VyID0gdXNlcjtcbiAgICAgICAgcmV0dXJuIHJlc29sdmUodHJ1ZSk7XG4gICAgICB9KShhY3Rpb24ucmVxdWVzdCwgYWN0aW9uLnJlc3BvbnNlLCBhY3Rpb24ubmV4dCk7XG4gICAgfSksXG4gIGN1cnJlbnRVc2VyQ2hlY2tlcjogKGFjdGlvbjogQWN0aW9uKSA9PiBhY3Rpb24ucmVxdWVzdC51c2VyLFxufTtcbiJdLCJ2ZXJzaW9uIjozfQ==