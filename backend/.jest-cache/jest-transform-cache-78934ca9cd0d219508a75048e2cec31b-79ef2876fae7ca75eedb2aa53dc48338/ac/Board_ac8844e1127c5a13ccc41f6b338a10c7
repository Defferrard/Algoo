c758d5e92395921ca7fb2edebdca69df
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const exceptions_1 = require("../exceptions/");
const pathfinding_1 = require("../pathfinding");
const _1 = require("./");
/**
 * A board is a 2D array of tiles. It is used to represent the game map. It also contains interactions with the tiles.
 */
class Board {
    _tiles;
    _entities = {};
    /**
     * Create a new Board from a 2D array of TileTypes.
     * @param tiles 2D array of TileTypes.
     */
    constructor(tiles) {
        // TODO : We can filter walls from _tiles array
        this._tiles = tiles.map((row, y) => row.map((type, x) => new _1.Tile({ x, y }, type)));
    }
    /**
     * Map the board into a 2D array of Nodes.
     */
    get mapNodes() {
        return this._tiles.map((row, y) => row.map((tile, x) => new pathfinding_1.Node({ x, y }, tile.movementCost)));
    }
    /**
     * Get the minimal movement cost of all tiles on the board, ignoring negative values.
     */
    get minimalMovementCost() {
        return this._tiles.reduce((min, row) => Math.min(min, ...row.map((tile) => tile.movementCost).filter((cost) => cost > 0)), Infinity);
    }
    /**
     * Get the tile at the given coordinate object.
     * @param coordinate 2D Coordinate object.
     */
    getTile(coordinate) {
        if (!this.isValidCoordinate(coordinate))
            throw new exceptions_1.OutOfBoundsException(coordinate);
        return this._tiles[coordinate.y][coordinate.x];
    }
    /**
     * Add an entity to the board at the given XY coordinate.
     * @param entity
     * @param x X axis coordinate.
     * @param y Y axis coordinate.
     */
    pushEntity(entity, coordinate) {
        if (!this.isValidCoordinate(coordinate))
            throw new exceptions_1.OutOfBoundsException(coordinate);
        if (this._entities[entity.uuid])
            throw new exceptions_1.EntityAlreadyExistsException(entity, coordinate);
        if (this.getTile(coordinate).entity)
            throw new exceptions_1.TileUnavailableException(coordinate);
        this._entities[entity.uuid] = new _1.Coordinate(coordinate);
        this.getTile(coordinate).entity = entity;
    }
    moveEntity(entity, coordinate) {
        if (!this.isValidCoordinate(coordinate))
            throw new exceptions_1.OutOfBoundsException(coordinate);
        if (!this._entities[entity.uuid])
            throw new exceptions_1.EntityNotExistsException(entity);
        if (this.getTile(coordinate).movementCost < 0)
            throw new exceptions_1.TileUnavailableException(coordinate);
        this.getTile(this.getEntityCoordinate(entity)).entity = undefined;
        this._entities[entity.uuid] = coordinate;
        this.getTile(coordinate).entity = entity;
    }
    deleteEntity(entity) {
        if (!this._entities[entity.uuid])
            throw new exceptions_1.EntityNotExistsException(entity);
        this.getTile(this._entities[entity.uuid]).entity = undefined;
        delete this._entities[entity.uuid];
    }
    getEntityCoordinate(entity) {
        if (!this._entities[entity.uuid])
            throw new exceptions_1.EntityNotExistsException(entity);
        return this._entities[entity.uuid];
    }
    /**
     * Get the sum movement cost of the given path.
     * @param path Path to get the cost of.
     */
    getPathCost(path) {
        return path
            .map((coordinate) => this.getTile(coordinate).movementCost)
            .reduce((accumulator, cost) => accumulator + cost, 0);
    }
    isValidCoordinate(coordinate) {
        return coordinate.x >= 0 && coordinate.x < this.width && coordinate.y >= 0 && coordinate.y < this.height;
    }
    get width() {
        return this._tiles[0].length;
    }
    get height() {
        return this._tiles.length;
    }
}
exports.default = Board;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXEdpdGh1YlxcQWxnb29cXGNvcmVcXHNyY1xcYm9hcmRcXEJvYXJkLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsK0NBS3dCO0FBRXhCLGdEQUFzQztBQUV0Qyx5QkFBc0M7QUFFdEM7O0dBRUc7QUFDSCxNQUFxQixLQUFLO0lBQ1AsTUFBTSxDQUFXO0lBQ2pCLFNBQVMsR0FBMEMsRUFBRSxDQUFDO0lBRXZFOzs7T0FHRztJQUNILFlBQVksS0FBbUI7UUFDN0IsK0NBQStDO1FBRS9DLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQWUsRUFBRSxDQUFTLEVBQUUsRUFBRSxDQUNyRCxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBYyxFQUFFLENBQVMsRUFBRSxFQUFFLENBQUMsSUFBSSxPQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FDakUsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFXLEVBQUUsQ0FBUyxFQUFFLEVBQUUsQ0FDaEQsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQVUsRUFBRSxDQUFTLEVBQUUsRUFBRSxDQUFDLElBQUksa0JBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FDMUUsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksbUJBQW1CO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQ3ZCLENBQUMsR0FBVyxFQUFFLEdBQVcsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFDL0csUUFBUSxDQUNULENBQUM7SUFDSixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsT0FBTyxDQUFDLFVBQTRCO1FBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsVUFBVSxDQUFDO1lBQUUsTUFBTSxJQUFJLGlDQUFvQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3BGLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILFVBQVUsQ0FBQyxNQUF5QixFQUFFLFVBQTRCO1FBQ2hFLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsVUFBVSxDQUFDO1lBQUUsTUFBTSxJQUFJLGlDQUFvQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3BGLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQUUsTUFBTSxJQUFJLHlDQUE0QixDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQztRQUM1RixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsTUFBTTtZQUFFLE1BQU0sSUFBSSxxQ0FBd0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUVwRixJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLGFBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDM0MsQ0FBQztJQUVELFVBQVUsQ0FBQyxNQUF5QixFQUFFLFVBQTRCO1FBQ2hFLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsVUFBVSxDQUFDO1lBQUUsTUFBTSxJQUFJLGlDQUFvQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3BGLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7WUFBRSxNQUFNLElBQUkscUNBQXdCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDN0UsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLFlBQVksR0FBRyxDQUFDO1lBQUUsTUFBTSxJQUFJLHFDQUF3QixDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTlGLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztRQUNsRSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxVQUFVLENBQUM7UUFDekMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQzNDLENBQUM7SUFFRCxZQUFZLENBQUMsTUFBeUI7UUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQztZQUFFLE1BQU0sSUFBSSxxQ0FBd0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUU3RSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztRQUM3RCxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRCxtQkFBbUIsQ0FBQyxNQUF5QjtRQUMzQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQUUsTUFBTSxJQUFJLHFDQUF3QixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzdFLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVEOzs7T0FHRztJQUNILFdBQVcsQ0FBQyxJQUF3QjtRQUNsQyxPQUFPLElBQUk7YUFDUixHQUFHLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFFLENBQUMsWUFBWSxDQUFDO2FBQzNELE1BQU0sQ0FBQyxDQUFDLFdBQW1CLEVBQUUsSUFBWSxFQUFFLEVBQUUsQ0FBQyxXQUFXLEdBQUcsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzFFLENBQUM7SUFFRCxpQkFBaUIsQ0FBQyxVQUF1RDtRQUN2RSxPQUFPLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLFVBQVUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssSUFBSSxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxVQUFVLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDM0csQ0FBQztJQUVELElBQUksS0FBSztRQUNQLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7SUFDL0IsQ0FBQztJQUVELElBQUksTUFBTTtRQUNSLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDNUIsQ0FBQztDQUNGO0FBdEdELHdCQXNHQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcR2l0aHViXFxBbGdvb1xcY29yZVxcc3JjXFxib2FyZFxcQm9hcmQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRW50aXR5QWxyZWFkeUV4aXN0c0V4Y2VwdGlvbixcbiAgRW50aXR5Tm90RXhpc3RzRXhjZXB0aW9uLFxuICBPdXRPZkJvdW5kc0V4Y2VwdGlvbixcbiAgVGlsZVVuYXZhaWxhYmxlRXhjZXB0aW9uLFxufSBmcm9tICcuLi9leGNlcHRpb25zLyc7XG5pbXBvcnQgdHlwZSB7IFJlc291cmNlcyB9IGZyb20gJy4uL2dhbWUvJztcbmltcG9ydCB7IE5vZGUgfSBmcm9tICcuLi9wYXRoZmluZGluZyc7XG5pbXBvcnQgdHlwZSB7IEVudGl0eSwgU2ltcGxlQ29vcmRpbmF0ZSwgVGlsZVR5cGUgfSBmcm9tICcuLyc7XG5pbXBvcnQgeyBDb29yZGluYXRlLCBUaWxlIH0gZnJvbSAnLi8nO1xuXG4vKipcbiAqIEEgYm9hcmQgaXMgYSAyRCBhcnJheSBvZiB0aWxlcy4gSXQgaXMgdXNlZCB0byByZXByZXNlbnQgdGhlIGdhbWUgbWFwLiBJdCBhbHNvIGNvbnRhaW5zIGludGVyYWN0aW9ucyB3aXRoIHRoZSB0aWxlcy5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQm9hcmQge1xuICBwcml2YXRlIHJlYWRvbmx5IF90aWxlczogVGlsZVtdW107XG4gIHByaXZhdGUgcmVhZG9ubHkgX2VudGl0aWVzOiB7IFtrZXkgaW4gc3RyaW5nXTogU2ltcGxlQ29vcmRpbmF0ZSB9ID0ge307XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBCb2FyZCBmcm9tIGEgMkQgYXJyYXkgb2YgVGlsZVR5cGVzLlxuICAgKiBAcGFyYW0gdGlsZXMgMkQgYXJyYXkgb2YgVGlsZVR5cGVzLlxuICAgKi9cbiAgY29uc3RydWN0b3IodGlsZXM6IFRpbGVUeXBlW11bXSkge1xuICAgIC8vIFRPRE8gOiBXZSBjYW4gZmlsdGVyIHdhbGxzIGZyb20gX3RpbGVzIGFycmF5XG5cbiAgICB0aGlzLl90aWxlcyA9IHRpbGVzLm1hcCgocm93OiBUaWxlVHlwZVtdLCB5OiBudW1iZXIpID0+XG4gICAgICByb3cubWFwKCh0eXBlOiBUaWxlVHlwZSwgeDogbnVtYmVyKSA9PiBuZXcgVGlsZSh7IHgsIHkgfSwgdHlwZSkpLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogTWFwIHRoZSBib2FyZCBpbnRvIGEgMkQgYXJyYXkgb2YgTm9kZXMuXG4gICAqL1xuICBnZXQgbWFwTm9kZXMoKTogTm9kZVtdW10ge1xuICAgIHJldHVybiB0aGlzLl90aWxlcy5tYXAoKHJvdzogVGlsZVtdLCB5OiBudW1iZXIpID0+XG4gICAgICByb3cubWFwKCh0aWxlOiBUaWxlLCB4OiBudW1iZXIpID0+IG5ldyBOb2RlKHsgeCwgeSB9LCB0aWxlLm1vdmVtZW50Q29zdCkpLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBtaW5pbWFsIG1vdmVtZW50IGNvc3Qgb2YgYWxsIHRpbGVzIG9uIHRoZSBib2FyZCwgaWdub3JpbmcgbmVnYXRpdmUgdmFsdWVzLlxuICAgKi9cbiAgZ2V0IG1pbmltYWxNb3ZlbWVudENvc3QoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fdGlsZXMucmVkdWNlKFxuICAgICAgKG1pbjogbnVtYmVyLCByb3c6IFRpbGVbXSkgPT4gTWF0aC5taW4obWluLCAuLi5yb3cubWFwKCh0aWxlKSA9PiB0aWxlLm1vdmVtZW50Q29zdCkuZmlsdGVyKChjb3N0KSA9PiBjb3N0ID4gMCkpLFxuICAgICAgSW5maW5pdHksXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRpbGUgYXQgdGhlIGdpdmVuIGNvb3JkaW5hdGUgb2JqZWN0LlxuICAgKiBAcGFyYW0gY29vcmRpbmF0ZSAyRCBDb29yZGluYXRlIG9iamVjdC5cbiAgICovXG4gIGdldFRpbGUoY29vcmRpbmF0ZTogU2ltcGxlQ29vcmRpbmF0ZSk6IFRpbGUge1xuICAgIGlmICghdGhpcy5pc1ZhbGlkQ29vcmRpbmF0ZShjb29yZGluYXRlKSkgdGhyb3cgbmV3IE91dE9mQm91bmRzRXhjZXB0aW9uKGNvb3JkaW5hdGUpO1xuICAgIHJldHVybiB0aGlzLl90aWxlc1tjb29yZGluYXRlLnldW2Nvb3JkaW5hdGUueF07XG4gIH1cblxuICAvKipcbiAgICogQWRkIGFuIGVudGl0eSB0byB0aGUgYm9hcmQgYXQgdGhlIGdpdmVuIFhZIGNvb3JkaW5hdGUuXG4gICAqIEBwYXJhbSBlbnRpdHlcbiAgICogQHBhcmFtIHggWCBheGlzIGNvb3JkaW5hdGUuXG4gICAqIEBwYXJhbSB5IFkgYXhpcyBjb29yZGluYXRlLlxuICAgKi9cbiAgcHVzaEVudGl0eShlbnRpdHk6IEVudGl0eTxSZXNvdXJjZXM+LCBjb29yZGluYXRlOiBTaW1wbGVDb29yZGluYXRlKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlzVmFsaWRDb29yZGluYXRlKGNvb3JkaW5hdGUpKSB0aHJvdyBuZXcgT3V0T2ZCb3VuZHNFeGNlcHRpb24oY29vcmRpbmF0ZSk7XG4gICAgaWYgKHRoaXMuX2VudGl0aWVzW2VudGl0eS51dWlkXSkgdGhyb3cgbmV3IEVudGl0eUFscmVhZHlFeGlzdHNFeGNlcHRpb24oZW50aXR5LCBjb29yZGluYXRlKTtcbiAgICBpZiAodGhpcy5nZXRUaWxlKGNvb3JkaW5hdGUpLmVudGl0eSkgdGhyb3cgbmV3IFRpbGVVbmF2YWlsYWJsZUV4Y2VwdGlvbihjb29yZGluYXRlKTtcblxuICAgIHRoaXMuX2VudGl0aWVzW2VudGl0eS51dWlkXSA9IG5ldyBDb29yZGluYXRlKGNvb3JkaW5hdGUpO1xuICAgIHRoaXMuZ2V0VGlsZShjb29yZGluYXRlKS5lbnRpdHkgPSBlbnRpdHk7XG4gIH1cblxuICBtb3ZlRW50aXR5KGVudGl0eTogRW50aXR5PFJlc291cmNlcz4sIGNvb3JkaW5hdGU6IFNpbXBsZUNvb3JkaW5hdGUpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaXNWYWxpZENvb3JkaW5hdGUoY29vcmRpbmF0ZSkpIHRocm93IG5ldyBPdXRPZkJvdW5kc0V4Y2VwdGlvbihjb29yZGluYXRlKTtcbiAgICBpZiAoIXRoaXMuX2VudGl0aWVzW2VudGl0eS51dWlkXSkgdGhyb3cgbmV3IEVudGl0eU5vdEV4aXN0c0V4Y2VwdGlvbihlbnRpdHkpO1xuICAgIGlmICh0aGlzLmdldFRpbGUoY29vcmRpbmF0ZSkubW92ZW1lbnRDb3N0IDwgMCkgdGhyb3cgbmV3IFRpbGVVbmF2YWlsYWJsZUV4Y2VwdGlvbihjb29yZGluYXRlKTtcblxuICAgIHRoaXMuZ2V0VGlsZSh0aGlzLmdldEVudGl0eUNvb3JkaW5hdGUoZW50aXR5KSkuZW50aXR5ID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuX2VudGl0aWVzW2VudGl0eS51dWlkXSA9IGNvb3JkaW5hdGU7XG4gICAgdGhpcy5nZXRUaWxlKGNvb3JkaW5hdGUpLmVudGl0eSA9IGVudGl0eTtcbiAgfVxuXG4gIGRlbGV0ZUVudGl0eShlbnRpdHk6IEVudGl0eTxSZXNvdXJjZXM+KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLl9lbnRpdGllc1tlbnRpdHkudXVpZF0pIHRocm93IG5ldyBFbnRpdHlOb3RFeGlzdHNFeGNlcHRpb24oZW50aXR5KTtcblxuICAgIHRoaXMuZ2V0VGlsZSh0aGlzLl9lbnRpdGllc1tlbnRpdHkudXVpZF0pLmVudGl0eSA9IHVuZGVmaW5lZDtcbiAgICBkZWxldGUgdGhpcy5fZW50aXRpZXNbZW50aXR5LnV1aWRdO1xuICB9XG5cbiAgZ2V0RW50aXR5Q29vcmRpbmF0ZShlbnRpdHk6IEVudGl0eTxSZXNvdXJjZXM+KTogU2ltcGxlQ29vcmRpbmF0ZSB7XG4gICAgaWYgKCF0aGlzLl9lbnRpdGllc1tlbnRpdHkudXVpZF0pIHRocm93IG5ldyBFbnRpdHlOb3RFeGlzdHNFeGNlcHRpb24oZW50aXR5KTtcbiAgICByZXR1cm4gdGhpcy5fZW50aXRpZXNbZW50aXR5LnV1aWRdO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgc3VtIG1vdmVtZW50IGNvc3Qgb2YgdGhlIGdpdmVuIHBhdGguXG4gICAqIEBwYXJhbSBwYXRoIFBhdGggdG8gZ2V0IHRoZSBjb3N0IG9mLlxuICAgKi9cbiAgZ2V0UGF0aENvc3QocGF0aDogU2ltcGxlQ29vcmRpbmF0ZVtdKTogbnVtYmVyIHtcbiAgICByZXR1cm4gcGF0aFxuICAgICAgLm1hcCgoY29vcmRpbmF0ZSkgPT4gdGhpcy5nZXRUaWxlKGNvb3JkaW5hdGUpIS5tb3ZlbWVudENvc3QpXG4gICAgICAucmVkdWNlKChhY2N1bXVsYXRvcjogbnVtYmVyLCBjb3N0OiBudW1iZXIpID0+IGFjY3VtdWxhdG9yICsgY29zdCwgMCk7XG4gIH1cblxuICBpc1ZhbGlkQ29vcmRpbmF0ZShjb29yZGluYXRlOiBTaW1wbGVDb29yZGluYXRlIHwgeyB4OiBudW1iZXI7IHk6IG51bWJlciB9KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGNvb3JkaW5hdGUueCA+PSAwICYmIGNvb3JkaW5hdGUueCA8IHRoaXMud2lkdGggJiYgY29vcmRpbmF0ZS55ID49IDAgJiYgY29vcmRpbmF0ZS55IDwgdGhpcy5oZWlnaHQ7XG4gIH1cblxuICBnZXQgd2lkdGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fdGlsZXNbMF0ubGVuZ3RoO1xuICB9XG5cbiAgZ2V0IGhlaWdodCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl90aWxlcy5sZW5ndGg7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==